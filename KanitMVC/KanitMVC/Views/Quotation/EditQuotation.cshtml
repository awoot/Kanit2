
@{
    ViewBag.Title = "Edit Quotation";
}

@Styles.Render("~/Content/kendo/styles/kendo.common-bootstrap.min.css")
@Styles.Render("~/Content/kendo/styles/kendo.bootstrap.min.css")

@Scripts.Render("~/Scripts/kendo/js/kendo.ui.core.min.js")
@Scripts.Render("~/Scripts/kendo/custom/selectProductWidget.js")

@Scripts.Render("~/Scripts/Common.js")


@*<h2>EditQuotation</h2>*@
<script src="@Url.Content("~/Scripts/CUDS/Sell/Quotation/EditQuotation.js")" type="text/javascript"></script>
<div class="modal fade" id="ShowDialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>
<div class="row">
    <div class="col-lg-12">
        <h3 class="page-header">
            <i class="fa fa-file-text-o"></i> Quotation / Edit
        </h3>
        <div class="col-xs-9 col-sm-10 col-lg-9">
            <div class="row m-bot15">
                <button type="button" id="btnSave" class="btn btn-primary" onclick="Isvalidate('Update', 'Quotation', @Request.Params["id"])">Send To Approve</button>
                <button type="button" id="btnSaveDraft" class="btn btn-warning" onclick="Isvalidate('SaveDraftQuotation', 'Quotation', @Request.Params["id"])">Save Draft</button>
                <button type="button" id="btnDiscard" class="btn btn-danger" onclick="Redirect()">Discard</button>
                <input type="hidden" id="hidDocver" />
            </div>
        </div>
        <div class="col-xs-3 col-sm-2 col-lg-3">
            <button type="button" id="btnRevise" class="btn btn-success" onclick="ConfirmRevise()">Revise<p id="verNo" class="revise"></p></button>
        </div>
    </div>
</div>
<form id="FormQuotation">
    <div class="row">
        <div class="col-lg-12">
            <section class="panel">
                <header class="panel-heading">
                    Quotation
                </header>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-5 control-label">Quotation No.</label>
                                <div class="col-sm-7">
                                    <input id="txtQuotationNo" class="form-control m-bot15" type="text">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Customer</label>
                                <div class="col-sm-9">
                                    <div class="input-group">
                                        <input type="text" id="txtCustomerName" class="form-control" />
                                        <input type="hidden" id="hidCompID" />
                                        <input type="hidden" id="hidQuotID" />
                                        <span class="input-group-addon">
                                            <a href="#Modalcompany" data-toggle="modal" onclick="BrowseCompany()">
                                                <span class="fa fa-search iconcolor">
                                                </span>
                                            </a>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-4 spandiv">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Note</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control m-bot15" rows="5" id="txtRemark"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix visible-xs-block"></div>
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-5 control-label">Your Reference</label>
                                <div class="col-sm-7">
                                    <input id="txtYourRef" class="form-control m-bot15" type="text">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-5 control-label">Quotation Date</label>
                                <div class="col-sm-7">
                                    <div class="input-group date" id="dtQuotationDate">
                                        <input id="txtQuotationDate" type="text" class="form-control" />
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix visible-xs-block"></div>
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-5 control-label">Validity(Days)</label>
                                <div class="col-sm-7">
                                    <input id="txtValidity" class="form-control m-bot15" type="text" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-5 control-label">Delivery Time(Weeks)</label>
                                <div class="col-sm-7">
                                    <input id="txtDelivery" class="form-control m-bot15" type="text" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="clearfix visible-xs-block"></div>
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-5 control-label">Payment Term(Days)</label>
                                <div class="col-sm-7">
                                    <input id="txtPaymentTerm" class="form-control m-bot15" type="text" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-5 control-label">Seller</label>
                                <div class="col-sm-7">
                                    <select id="cmbSeller" class="form-control m-bot15"></select>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <div style="position:relative;">
                                    <label class="col-sm-2 control-label">State</label>
                                    <div class="col-sm-7">
                                        <select id="cmbState" class="form-control m-bot15"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix visible-xs-block"></div>
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-5 control-label">Warning Date</label>
                                <div class="col-sm-7">
                                    <div class="input-group date" id="dtWarningDate">
                                        <input id="txtWarningDate" type="text" class="form-control" />
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">Cost Sheet</label>
                                <div class="col-sm-8">
                                    <div style="position:relative;">
                                        @*<a class="btn btn-primary marginbuttom15" href="javascript:;">
                                                Choose File...
                                                <input id="FileUploadCostSheet" type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' name="file_source" size="30" onchange='$("#txtUpload").html($(this).val());'>
                                            </a>
                                            &nbsp;
                                            <span class='label label-info' id="txtUpload"></span>*@
                                        <input type="file" id="FileUpload1">
                                        <a href="IndexCostSheet.html">รายละเอียด</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-4 spandiv">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Reason</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control m-bot15" rows="5" id="txtReason"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix visible-xs-block"></div>
                        <div class="col-xs-6 col-sm-12">
                            <div class="col-xs-6 col-sm-5 padleft0">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Inco Term</label>
                                    <div class="col-sm-7">
                                        <select id="cmbIncoTerm" class="form-control m-bot15"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix visible-xs-block"></div>
                            <div class="col-xs-6 col-sm-4 padleft0 mgn-left15">
                                <div class="form-group">
                                    <input id="txtIcoTermDetail" class="form-control m-bot15" type="text">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-12">
                            <div class="col-xs-6 col-sm-5 padleft0">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Currency</label>
                                    <div class="col-sm-7">
                                        <select id="cmbCurrency" class="form-control m-bot15"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <section class="panel">
                                <!--<div class="col-lg-6"></div>-->
                                <div id="divProductDetail">

                                    <header class="panel-heading">
                                        <div class="col-xs-7 col-sm-10 col-lg-11">Description</div>
                                        <div class="col-xs-5 col-sm-2 col-lg-1">
                                            <a href="#" data-toggle="modal" class="btn btn-default btn-sm plusicon" data-bind="events: {click: onAddDetail}"><img src="../img/icons/Create.png" id="list" /></a>

                                            @*<a href="#ModalDescription" data-toggle="modal" class="btn btn-default btn-sm plusicon" onclick="GetDataDescription(0)"><img src="../img/icons/Create.png" id="list" /></a>*@
                                        </div>
                                    </header>
                                    <div class="table-responsive">
                                        <table style="width: 100%" id="tblCompany" class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th style="width: 40px;">No.</th>
                                                    <th style="width: 80px;">Line No.</th>
                                                    <th style="width: 130px;">Product</th>
                                                    <th style="">Description</th>
                                                    <th style="width: 90px;">Quantity</th>
                                                    <th style="width: 60px;">Unit</th>
                                                    <th style="width: 100px;" class="text-center">Unit Price</th>
                                                    <th style="width: 100px;" class="text-center">Amount</th>
                                                    <th style="width: 80px;"><i class="icon_cogs"></i> Action</th>
                                                </tr>
                                            </thead>
                                            <tbody data-template="productDetailTemplate" data-bind="source: Detail"></tbody>
                                            <tbody>
                                                <tr>
                                                    <td colspan="7">Sub Total</td>
                                                    <td colspan="2" class="width50">
                                                        <label class="width100 text-right" data-format="n2" data-bind="text: SubTotal" />
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="7">Discount</td>
                                                    <td colspan="2" class="width100">
                                                        <input data-role="numerictextbox"
                                                               data-format="n0"
                                                               data-decimals="0"
                                                               data-spinners="false"
                                                               class="kanitNumeric"
                                                               style="width: 100px;"
                                                               data-bind="value: Discount, events: {change: onChangeDiscount}" />
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="7">Total</td>
                                                    <td colspan="2" class="width100">
                                                        <label class="width100 text-right" data-format="n2" data-bind="text: Total" />
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="7">
                                                        <div class="floatleft mgn-right5">Vat(%)</div>
                                                        <select id="cmbVat" class="form-control width60"
                                                                data-bind="value: Vat, events: {change: onChangeVat}"></select>
                                                    </td>
                                                    <td colspan="2" class="width100">
                                                        <label class="width100 text-right" data-format="n2" type="text" data-bind="text: VatValue" />
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="7" class="fontbold">Net Total</td>
                                                    <td colspan="2" class="width100">
                                                        <label class="width100 text-right" data-format="n2" data-bind="text: NetTotal" />
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            <section class="panel">
                                <header class="panel-heading">
                                    <div class="col-xs-7 col-sm-10 col-lg-11">Work Flow</div>
                                    <div class="col-xs-5 col-sm-2 col-lg-1">
                                        <a href="#myModal" data-toggle="modal" class="btn btn-default btn-sm plusicon"><img src="../img/icons/Create.png" id="list" /></a>
                                    </div>
                                </header>
                                <div class="table-responsive">
                                    <table id="tblCompany" class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>No.</th>
                                                <th>Full Name</th>
                                                <th>Position</th>
                                                <th>Act_On</th>
                                                <th>Act_Date</th>
                                                <th>Result</th>
                                                <th colspan="3" class="text-center"><i class="icon_cogs"></i> Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="result">
                                            <tr>
                                                <td>1</td>
                                                <td>นางจริยา รุ่งรัตน์</td>
                                                <td>Admin</td>
                                                <td>Creater</td>
                                                <td>31/8/2017</td>
                                                <td></td>
                                                <td class="width60">
                                                    <a class="btn btn-success" href="#myModal" data-toggle="modal"><i class="fa fa-check-square-o"></i></a>
                                                </td>
                                                <td class="width60">
                                                    <a class="btn btn-danger" href="#myModal" data-toggle="modal"><i class="icon_close_alt2"></i></a>
                                                </td>
                                                <td class="width60">
                                                    <a class="btn btn-warning" href="#myModal" data-toggle="modal"><i class="fa fa-reply"></i></a>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>1</td>
                                                <td>นายสมรักษ์ คำสิงห์</td>
                                                <td>Sale</td>
                                                <td>Approver</td>
                                                <td>01/09/2017</td>
                                                <td>Approved</td>
                                                <td class="width60">
                                                    <a class="btn btn-success" href="#myModal" data-toggle="modal"><i class="fa fa-check-square-o"></i></a>
                                                </td>
                                                <td class="width60">
                                                    <a class="btn btn-danger" href="#myModal" data-toggle="modal"><i class="icon_close_alt2"></i></a>
                                                </td>
                                                <td class="width60">
                                                    <a class="btn btn-warning" href="#myModal" data-toggle="modal"><i class="fa fa-reply"></i></a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </section>
            <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="ModalDescription" class="modal fade">
                <div class="modal-dialog popup80">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                            <h4 class="modal-title">Description</h4>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-xs-12 col-sm-6">
                                    <div class="form-group">
                                        <label class="col-xs-12 col-sm-3 control-label margintop15">Description</label>
                                        <div class="col-xs-12 col-sm-9">
                                            <input type="hidden" id="hidQuoDetailID" />
                                            @*<input type="hidden" id="hidCompID" />*@
                                            <textarea class="form-control m-bot15 margintop15" rows="5" id="txtDescription"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <!--<div class="clearfix visible-xs-block"></div>-->
                                <div class="col-xs-12 col-sm-6">
                                    <div class="form-group">
                                        <label class="col-xs-12 col-sm-3 control-label margintop15">Quantity</label>
                                        <div class="col-xs-12 col-sm-4">
                                            <input id="txtQuantity" class="form-control m-bot15 margintop15" type="text">
                                        </div>
                                        <label class="col-xs-12 col-sm-1 control-label margintop15">Unit</label>
                                        <div class="col-xs-12 col-sm-3">
                                            <select id="cmbUnit" class="form-control m-bot15 margintop15"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-6">
                                    <div class="form-group">
                                        <label class="col-xs-12 col-sm-3 control-label">Unit Price</label>
                                        <div class="col-xs-12 col-sm-4">
                                            <input id="txtUnitPrice" class="form-control m-bot15" type="text" onblur="CalAmount()" value="0.00">
                                        </div>
                                    </div>
                                </div>
                                <!--<div class="clearfix visible-xs-block"></div>-->
                                <div class="col-xs-12 col-sm-6">
                                    <div class="form-group">
                                        <label class="col-xs-12 col-sm-3 control-label">Currency</label>
                                        <div class="col-xs-12 col-sm-3">
                                            <select id="cmbCurrency" class="form-control m-bot15" onchange="GetRate()"></select>
                                        </div>
                                        <!--<label class="col-xs-12 col-sm-1 control-label">Unit</label>-->
                                        <div class="col-xs-12 col-sm-3">
                                            <input id="txtRate" class="form-control m-bot15 text-right" type="text" value="0" disabled>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-6">
                                    <div class="form-group">
                                        <label class="col-xs-12 col-sm-3 control-label">Product Code</label>
                                        <div class="col-xs-12 col-sm-6">
                                            <div class="input-group date">
                                                <input id="txtProductCodepopup" type="text" class="form-control" />
                                                <input type="hidden" id="hidProductID" />
                                                <input type="hidden" id="hidQuoteID" />
                                                <span class="input-group-addon">
                                                    <a href="#ModalProducts" data-toggle="modal" onclick="BrowseProduct()">
                                                        <span class="fa fa-search iconcolor">
                                                        </span>
                                                    </a>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--<div class="clearfix visible-xs-block"></div>-->
                                <div class="col-xs-12 col-sm-6">
                                    <div class="form-group">
                                        <label class="col-xs-12 col-sm-3 control-label">Amount</label>
                                        <div class="col-xs-12 col-sm-4">
                                            <input id="txtAmount" class="form-control m-bot15" type="text" value="0" disabled>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" id="btnSubmit" class="btn btn-primary" onclick="SaveQuotationDetail(@Request.Params["id"])">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="ModalProducts" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header1">
                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                            <h4 class="modal-title">Product</h4>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <section class="panel">
                                        <!--<div class="col-lg-6"></div>-->
                                        <header class="panel-heading panel-heading1">
                                            <div class="col-lg-7"></div>
                                            <div class="col-lg-5 padding7"><input id="searchInput" class="form-control" placeholder="Search" type="text"></div>
                                        </header>
                                        <div class="table-responsive">
                                            <table id="tblCompany" class="table table-striped table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>No.</th>
                                                        <th>Product Code</th>
                                                        <th>Unit</th>
                                                        <th>Selling Price</th>
                                                        <th>Remain</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="resultProduct"></tbody>
                                            </table>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @* ========================================================== Company ==================================================*@
            <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="Modalcompany" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header1">
                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                            <h4 class="modal-title">Company</h4>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <section class="panel">
                                        <!--<div class="col-lg-6"></div>-->
                                        <header class="panel-heading panel-heading1">
                                            <div class="col-lg-7"></div>
                                            <div class="col-lg-5 padding7"><input id="txtSearchCompany" class="form-control" placeholder="Search" type="text"></div>
                                        </header>
                                        <div class="table-responsive">
                                            <table id="tblCompany" class="table table-striped table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>No.</th>
                                                        <th>Company Name (TH)</th>
                                                        <th>Company Type</th>
                                                        <th>Customer Segment</th>
                                                        <th>Credit Term</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="resultCompany">
                                                    <tr>
                                                        <td>1</td>
                                                        <td>แลนด์ แอนด์ เฮ้าส์</td>
                                                        <td>Customer</td>
                                                        <td>EPC</td>
                                                        <td>30</td>
                                                    </tr>
                                                    <tr>
                                                        <td>2</td>
                                                        <td>บริษัท พิศนุการช่าง จำกัด</td>
                                                        <td>Supplier</td>
                                                        <td>End-User</td>
                                                        <td>60</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<script type="text/javascript">

    $(document).ready(function () {
        //var input = window.location.href;
        //var after = input.split('?')[1]
        //var val = after.split('=');
        //var Isview = val[2];
        //GetCurrency();

        form_onInit(@Request.Params["id"]);

        //ControlEnable(Isview);
    });
    function ConfirmRevise() {
        $('#ShowDialog').modal('show');
        var html = '<div class="modal-dialog modal-dialog-info">';
        html += '<div class="modal-content">';
        html += '<div class="modal-header modal-header-info">';
        html += '<button type="button" class="close" data-dismiss="modal">&times;</button>';
        html += '<h4 class="modal-title">Quotation Revision</h4>';
        html += '</div>';
        html += '<div class="modal-body modal-body-info">ยืนยันการสร้าง Revision </div>';
        html += '<div class="modal-footer">';
        html += '<button type="button" class="btn btn-info" onclick="GetDocversion()" data-dismiss="modal">Yes</button>';
        html += '<button type="button" class="btn btn-info" data-dismiss="modal">No</button>';
        html += '</div></div></div>';
        document.getElementById("ShowDialog").innerHTML = html;
    }
</script>

<script id="productDetailTemplate" type="text/template">
    <tr>
        <td>
            <label data-bind="text: No"></label>
        </td>
        <td>
            <input class="form-control m-bot15"
                   data-bind="value: LineNo"
                   style="width: 80px;" />
        </td>
        <td>
            <input data-role="selectproduct"
                   data-bind="value: Product, events: {change: onChangeProduct}"
                   style="width: 130px;" />
        </td>
        <td>
            <textarea style="height: 80px;" class="form-control m-bot15" data-bind="value: Description"></textarea>
        </td>
        <td>
            <input data-role="numerictextbox"
                   data-format="n0"
                   data-decimals="0"
                   data-spinners="false"
                   class="kanitNumeric"
                   data-bind="value: Quantity, events: {change: onUpdateAmount}"
                   style="width: 90px;" />
        </td>
        <td>
            <label data-bind="text: Product.UnitName"></label>
        </td>
        <td>
            <label data-bind="text: UnitPrice"
                   style="width: 100px; display: none"></label>

            <input data-role="numerictextbox"
                   data-spinners="false"
                   data-format="n2"
                   class="kanitNumeric"
                   data-bind="value: _UnitPrice, events: {change: onChangeUnitPrice}"
                   style="width: 80px;" />
        </td>
        <td>
            <label data-format="n2"
                   data-bind="text: Amount"
                   style="width: 100px; text-align: right"></label>
        </td>
        <td>
            <a class="btn btn-danger" href="\#" data-toggle="modal" data-bind="events: {click: onDelete}"><i class="icon_close_alt2"></i></a>
        </td>
    </tr>
</script>

<style>
    .kanitNumeric .k-numeric-wrap {
        padding-right: 5px;
    }

    .kanitNumeric .k-input {
        text-align: right;
        padding-right: 5px;
    }
</style>
